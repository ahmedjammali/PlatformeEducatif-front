<!-- payment-management.component.html (Complete Implementation with Uniform & Transportation) -->
<div class="payment-management-container">
  <!-- Header Section -->
  <header class="header-section">
    <!-- Title and Academic Year Row -->
    <div class="header-top">
      <div class="title-section">
        <div class="title-content">
          <span class="title-icon">üí≥</span>
          <div class="title-wrapper">
            <h1 class="title-text">Gestion des Paiements</h1>
            <p class="subtitle-text">G√©rez les frais scolaires, uniformes et transport de mani√®re centralis√©e</p>
          </div>
        </div>
        <div class="academic-year-badge">
          <span class="year-label">Ann√©e Acad√©mique</span>
          <span class="year-value">{{ currentAcademicYear }}</span>
        </div>
      </div>
    </div>
    
    <!-- Actions and Quick Stats Row -->
    <div class="header-bottom">
      <!-- Enhanced Action Buttons -->
      <div class="actions-section">
        <!-- Navigation Buttons -->
        <div class="nav-actions">
          <button class="btn-action btn-config" (click)="navigateToConfig()" title="Configurer les tarifs par niveau">
            <div class="btn-icon-wrapper">
              <span class="btn-icon">‚öôÔ∏è</span>
            </div>
            <div class="btn-content">
              <span class="btn-title">Configuration</span>
              <span class="btn-description">Tarifs par niveau</span>
            </div>
          </button>

          <button 
            class="btn-action btn-generate" 
            (click)="bulkGeneratePayments()" 
            [disabled]="isLoading || getStudentsWithoutRecord() === 0" 
            [class.btn-loading]="isLoading"
            title="Cr√©er des dossiers de paiement personnalis√©s par niveau">
            
            <div class="btn-icon-wrapper">
              <div class="loading-spinner" *ngIf="isLoading"></div>
              <span class="btn-icon" *ngIf="!isLoading">üéØ</span>
            </div>
            
            <div class="btn-content">
              <span class="btn-title">Cr√©er Dossiers</span>
              <span class="btn-description" *ngIf="getStudentsWithoutRecord() > 0">
                {{getStudentsWithoutRecord()}} √©tudiant(s) sans dossier
              </span>
              <span class="btn-description success" *ngIf="getStudentsWithoutRecord() === 0">
                ‚úì Tous les dossiers cr√©√©s
              </span>
            </div>
            
            <div class="btn-tooltip">
              <strong>G√©n√©ration automatique par niveau</strong><br>
              Cr√©e des dossiers personnalis√©s selon le niveau de chaque √©tudiant avec tarifs sp√©cifiques pour frais scolaires, uniforme et transport
            </div>
          </button>

          <button 
            class="btn-action btn-update" 
            (click)="updateExistingPayments()" 
            [disabled]="isLoading || !paymentConfig" 
            [class.btn-loading]="isLoading" 
            *ngIf="paymentConfig"
            title="Mettre √† jour avec les nouveaux tarifs par niveau">
            
            <div class="btn-icon-wrapper">
              <div class="loading-spinner" *ngIf="isLoading"></div>
              <span class="btn-icon" *ngIf="!isLoading">üîÑ</span>
            </div>
            
            <div class="btn-content">
              <span class="btn-title">Actualiser Tarifs</span>
              <span class="btn-description">Appliquer nouveaux montants</span>
            </div>
            
            <div class="btn-tooltip">
              <strong>Mise √† jour des tarifs</strong><br>
              Met √† jour tous les dossiers avec les nouveaux tarifs par niveau, uniforme et transport configur√©s
            </div>
          </button>

          <button 
            class="btn-action btn-delete-all" 
            (click)="deleteAllPaymentRecords()" 
            [disabled]="isLoading || getStudentsWithRecord() === 0" 
            [class.btn-loading]="isLoading"
            title="Supprimer tous les dossiers de paiement">
            
            <div class="btn-icon-wrapper">
              <div class="loading-spinner" *ngIf="isLoading"></div>
              <span class="btn-icon" *ngIf="!isLoading">üóëÔ∏è</span>
            </div>
            
            <div class="btn-content">
              <span class="btn-title">Supprimer Tous</span>
              <span class="btn-description" *ngIf="getStudentsWithRecord() > 0">
                {{getStudentsWithRecord()}} dossier(s) existant(s)
              </span>
              <span class="btn-description" *ngIf="getStudentsWithRecord() === 0">
                Aucun dossier √† supprimer
              </span>
            </div>
            
            <div class="btn-tooltip">
              <strong>Suppression totale</strong><br>
              Supprime d√©finitivement tous les dossiers de paiement. Cette action est irr√©versible.
            </div>
          </button>
        </div>
      </div>
    </div>
  </header>



  <!-- Updated Filters Section -->
  <section class="filters-section">
    <div class="filter-card">
      <div class="filter-header">
        <h3>Filtres & Recherche</h3>
        <button class="btn-clear" (click)="clearFilters()" title="Effacer les filtres">
          <span class="icon">üóëÔ∏è</span>
        </button>
      </div>
      
      <div class="filter-container">
        <!-- Search Input -->
        <div class="search-field">
          <span class="search-icon">üîç</span>
          <input 
            type="text" 
            [value]="searchControl.value" 
            (input)="onSearchInput($event)"
            placeholder="Rechercher un √©tudiant..."
            class="search-input">
          <button 
            *ngIf="searchControl.value" 
            (click)="searchControl.setValue('')"
            class="clear-search">
            <span class="icon">‚úñÔ∏è</span>
          </button>
        </div>

        <!-- Filter Controls -->
        <div class="filter-controls">
          <div class="form-group">
            <label for="academicYear">Ann√©e Acad√©mique</label>
            <select 
              id="academicYear"
              [value]="filterForm.get('academicYear')?.value"
              (change)="onAcademicYearChange($event)"
              class="form-select">
              <option *ngFor="let year of academicYears" [value]="year">
                {{ year }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label for="paymentStatus">Statut de Paiement</label>
            <select 
              id="paymentStatus"
              [value]="filterForm.get('paymentStatus')?.value"
              (change)="onPaymentStatusChange($event)"
              class="form-select">
              <option value="">Tous les statuts</option>
              <option *ngFor="let status of paymentStatuses.slice(1)" [value]="status.value">
                {{ status.label }}
              </option>
            </select>
          </div>

          <!-- Grade Category Filter -->
          <div class="form-group">
            <label for="gradeCategory">Niveau d'√âducation</label>
            <select 
              id="gradeCategory"
              [value]="filterForm.get('gradeCategory')?.value"
              (change)="onGradeCategoryChange($event)"
              class="form-select">
              <option value="">Tous les niveaux</option>
              <option *ngFor="let category of gradeCategories.slice(1)" [value]="category.value">
                {{ category.label }}
              </option>
            </select>
          </div>

          <!-- Specific Grade Filter -->
          <div class="form-group">
            <label for="grade">Classe Sp√©cifique</label>
            <select 
              id="grade"
              [value]="filterForm.get('grade')?.value"
              (change)="onGradeChange($event)"
              class="form-select">
              <option value="">Toutes les classes</option>
              <option *ngFor="let grade of getFilteredGrades().slice(1)" [value]="grade.value">
                {{ grade.label }}
              </option>
            </select>
          </div>

          <!-- Class Filter -->
          <div class="form-group">
            <label for="classId">Section</label>
            <select 
              id="classId"
              [value]="filterForm.get('classId')?.value"
              (change)="onClassIdChange($event)"
              class="form-select">
              <option value="">Toutes les sections</option>
              <option *ngFor="let classItem of getFilteredClasses()" [value]="classItem._id">
                {{ classItem.name }} ({{ classItem.grade }})
              </option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Quick Actions -->
  <section class="quick-actions-section" *ngIf="getQuickActions().length > 0">
    <div 
      class="quick-action" 
      *ngFor="let action of getQuickActions()"
      (click)="action.action()"
      [style.--action-color]="action.color">
      <span class="action-icon">{{ action.icon }}</span>
      <span class="action-text">{{ action.label }}</span>
      <span class="action-label">Voir ‚Üí</span>
    </div>
  </section>

  <!-- Students Table -->
  <section class="table-section">
    <div class="table-card">
      <div class="table-header">
        <div class="table-title">
          <h2>Liste des √âtudiants</h2>
          <div class="status-chips">
            <button 
              *ngFor="let status of paymentStatuses.slice(1)" 
              class="status-chip"
              [class.active]="filterForm.get('paymentStatus')?.value === status.value"
              (click)="filterByStatus(status.value)"
              [style.--chip-color]="status.color">
              <span class="chip-icon">{{ getStatusEmoji(status.value) }}</span>
              <span class="chip-text">{{ getStatusCount(status.value) }}</span>
            </button>
          </div>
        </div>
        
        <div class="table-info">
          <span class="student-count">
            <strong>{{ students.length }}</strong> √©tudiants
            <span *ngIf="searchControl.value || hasActiveFilters()"> - Filtr√©s</span>
          </span>
        </div>
      </div>

      <div class="table-container" [class.loading]="isLoading">
        <!-- Loading Overlay -->
        <div class="loading-overlay" *ngIf="isLoading">
          <div class="spinner"></div>
          <p>Chargement des donn√©es...</p>
        </div>

        <!-- Students Table -->
        <div class="table-wrapper">
          <table class="payment-table">
            <thead>
              <tr>
                <th class="expand-col"></th>
                <th class="student-col">√âtudiant</th>
                <th class="grade-col">Niveau & Section</th>
                <th class="status-col">Statut</th>
                <th class="financial-col">Informations Financi√®res</th>
                <th class="components-col">Composants</th>
                <th class="progress-col">Progression</th>
                <th class="actions-col">Actions</th>
              </tr>
            </thead>
            <tbody>
              <ng-container *ngFor="let student of students; let i = index; trackBy: trackByStudentId">
                <!-- Main Student Row -->
                <tr class="student-row" [class.expanded]="expandedStudentId === student._id">
                  <td class="expand-cell">
                    <button 
                      class="expand-btn"
                      (click)="toggleExpandRow(student)" 
                      [disabled]="!student.hasPaymentRecord">
                      <span class="expand-icon">
                        {{ expandedStudentId === student._id ? '‚¨ÜÔ∏è' : '‚¨áÔ∏è' }}
                      </span>
                    </button>
                  </td>
                  
                  <td class="student-cell">
                    <div class="student-info">
                      <div class="student-avatar">
                        <span class="avatar-icon">{{ student.name.charAt(0).toUpperCase() }}</span>
                      </div>
                      <div class="student-details">
                        <div class="student-name">{{ student.name }}</div>
                        <div class="student-email">{{ student.email }}</div>
                      </div>
                    </div>
                  </td>

                  <!-- Grade and Class Cell -->
                  <td class="grade-cell">
                    <div class="grade-info">
                      <span class="grade-name">{{ getClassGrade(student) }}</span>
                      <span class="section-name" *ngIf="getClassName(student) !== 'Non assign√©'">
                        Section: {{ getClassName(student) }}
                      </span>
                      <span 
                        *ngIf="student.gradeCategory" 
                        class="grade-category-chip"
                        [style.background-color]="getGradeCategoryColor(student.gradeCategory)"
                        [style.color]="'white'">
                        {{ getGradeCategoryLabel(student.gradeCategory) }}
                      </span>
                    </div>
                  </td>

                  <td class="status-cell">
                    <div 
                      class="status-badge"
                      [class]="'status-' + (student.paymentRecord?.overallStatus || 'no_record')">
                      <span class="status-icon">
                        {{ getStatusEmoji(student.paymentRecord?.overallStatus || 'no_record') }}
                      </span>
                      <span class="status-text">
                        {{ getStatusLabel(student.paymentRecord?.overallStatus || 'no_record') }}
                      </span>
                    </div>
                  </td>

                  <!-- Financial Information Cell -->
                  <td class="financial-cell">
                    <div class="financial-info" *ngIf="student.paymentRecord">
                      <div class="amount-row">
                        <span class="amount-label">Total:</span>
                        <span class="amount-value total">
                          {{ formatCurrency(getTotalAmounts(student)?.grandTotal || 0) }}
                        </span>
                      </div>
                      <div class="amount-row">
                        <span class="amount-label">Pay√©:</span>
                        <span class="amount-value paid">
                          {{ formatCurrency(getPaidAmounts(student)?.grandTotal || 0) }}
                        </span>
                      </div>
                      <div class="amount-row">
                        <span class="amount-label">Restant:</span>
                        <span 
                          class="amount-value remaining" 
                          [class.overdue]="student.paymentRecord.overallStatus === 'overdue'">
                          {{ formatCurrency(getRemainingAmounts(student)?.grandTotal || 0) }}
                        </span>
                      </div>
                    </div>
                    <div class="no-record" *ngIf="!student.paymentRecord">
                      <span class="no-record-icon">‚ùì</span>
                      <span>Aucun dossier</span>
                    </div>
                  </td>

                  <!-- Components Status Cell -->
                  <td class="components-cell">
                    <div class="components-info" *ngIf="student.paymentRecord">
                      <!-- Tuition Component -->
                      <div class="component-item tuition">
                        <span class="component-icon" title="Frais scolaires">üìö</span>
                        <span class="component-status" 
                              [class]="'status-' + getComponentStatus(student, 'tuition')"
                              [title]="getComponentStatusLabel(student, 'tuition')">
                          {{ getStatusEmoji(getComponentStatus(student, 'tuition')) }}
                        </span>
                        <span class="component-amount">
                          {{ formatCurrency(getTotalAmounts(student)?.tuition || 0) }}
                        </span>
                      </div>
                      
                      <!-- Uniform Component -->
                      <div class="component-item uniform" *ngIf="hasUniform(student)">
                        <span class="component-icon" title="Uniforme">üëî</span>
                        <span class="component-status" 
                              [class]="'status-' + getComponentStatus(student, 'uniform')"
                              [title]="getComponentStatusLabel(student, 'uniform')">
                          {{ getStatusEmoji(getComponentStatus(student, 'uniform')) }}
                        </span>
                        <span class="component-amount">
                          {{ formatCurrency(getTotalAmounts(student)?.uniform || 0) }}
                        </span>
                      </div>
                      
                      <!-- Transportation Component -->
                      <div class="component-item transportation" *ngIf="hasTransportation(student)">
                        <span class="component-icon" title="Transport">üöå</span>
                        <span class="component-status" 
                              [class]="'status-' + getComponentStatus(student, 'transportation')"
                              [title]="getComponentStatusLabel(student, 'transportation')">
                          {{ getStatusEmoji(getComponentStatus(student, 'transportation')) }}
                        </span>
                        <span class="component-amount">
                          {{ formatCurrency(getTotalAmounts(student)?.transportation || 0) }}
                        </span>
                        <span class="transport-type">{{ getTransportationType(student) }}</span>
                      </div>
                      
                      <!-- No Components Message -->
                      <div class="no-components" *ngIf="!hasUniform(student) && !hasTransportation(student)">
                        <span class="no-components-text">Frais scolaires uniquement</span>
                      </div>
                    </div>
                    <span class="no-record" *ngIf="!student.paymentRecord">‚Äî</span>
                  </td>

                  <td class="progress-cell">
                    <div class="progress-container" *ngIf="student.paymentRecord">
                      <div class="progress-info">
                        <span class="progress-percentage">{{ calculateProgress(student) }}%</span>
                        <div class="progress-bar mini">
                          <div 
                            class="progress-fill"
                            [class]="'progress-' + student.paymentRecord.overallStatus"
                            [style.width.%]="calculateProgress(student)">
                          </div>
                        </div>
                      </div>
                      <!-- Component Progress Bars -->
                      <div class="component-progress">
                        <div class="component-progress-item tuition">
                          <span class="component-label">üìö</span>
                          <div class="mini-progress-bar">
                            <div class="mini-progress-fill" [style.width.%]="getComponentProgress(student, 'tuition')"></div>
                          </div>
                        </div>
                        <div class="component-progress-item uniform" *ngIf="hasUniform(student)">
                          <span class="component-label">üëî</span>
                          <div class="mini-progress-bar">
                            <div class="mini-progress-fill" [style.width.%]="getComponentProgress(student, 'uniform')"></div>
                          </div>
                        </div>
                        <div class="component-progress-item transportation" *ngIf="hasTransportation(student)">
                          <span class="component-label">üöå</span>
                          <div class="mini-progress-bar">
                            <div class="mini-progress-fill" [style.width.%]="getComponentProgress(student, 'transportation')"></div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <span class="no-record" *ngIf="!student.paymentRecord">‚Äî</span>
                  </td>

                  <!-- Actions Cell -->
                  <td class="actions-cell">
                    <div class="action-buttons">
                      <!-- Generate Payment Record -->
                      <button 
                        class="action-btn generate"
                        title="G√©n√©rer dossier de paiement"
                        *ngIf="!student.hasPaymentRecord"
                        (click)="openGenerateDialog(student)">
                        <span class="btn-icon">‚ûï</span>
                      </button>

                      <!-- Tuition Payment -->
                      <button 
                        class="action-btn tuition"
                        title="Paiement frais scolaires"
                        *ngIf="student.hasPaymentRecord && canPayComponent(student, 'tuition')"
                        (click)="openPaymentDialog(student, 'tuition_monthly')">
                        <span class="btn-icon">üìö</span>
                      </button>

                      <!-- Uniform Payment -->
                      <button 
                        class="action-btn uniform"
                        title="Paiement uniforme"
                        *ngIf="student.hasPaymentRecord && canPayComponent(student, 'uniform')"
                        (click)="openPaymentDialog(student, 'uniform')">
                        <span class="btn-icon">üëî</span>
                      </button>

                      <!-- Transportation Payment -->
                      <button 
                        class="action-btn transportation"
                        title="Paiement transport"
                        *ngIf="student.hasPaymentRecord && canPayComponent(student, 'transportation')"
                        (click)="openPaymentDialog(student, 'transportation_monthly')">
                        <span class="btn-icon">üöå</span>
                      </button>

                      <!-- Annual Payment -->
                      <button 
                        class="action-btn annual"
                        title="Paiement annuel"
                        *ngIf="student.hasPaymentRecord && !student.paymentRecord?.annualTuitionPayment?.isPaid"
                        (click)="openPaymentDialog(student, 'tuition_annual')">
                        <span class="btn-icon">üìã</span>
                      </button>


                   <button 
                        class="action-btn invoice"
                        title="Extraire la facture"
                        *ngIf="student.hasPaymentRecord"
                        (click)="openInvoiceDialog(student)">
                        <span class="btn-icon">üìÑ</span>
                      </button>

                      <!-- View Details -->
                      <button 
                        class="action-btn details"
                        title="Voir d√©tails"
                        *ngIf="student.hasPaymentRecord"
                        (click)="toggleExpandRow(student)">
                        <span class="btn-icon">üëÅÔ∏è</span>
                      </button>

                      <!-- Edit Payment Record -->
                      <button 
                        class="action-btn edit"
                        title="Modifier les composants"
                        *ngIf="student.hasPaymentRecord"
                        (click)="editPaymentRecord(student)">
                        <span class="btn-icon">‚úèÔ∏è</span>
                      </button>

                      <!-- Delete Payment Record -->
                      <button 
                        class="action-btn delete"
                        title="Supprimer dossier"
                        *ngIf="student.hasPaymentRecord"
                        (click)="deletePaymentRecord(student)">
                        <span class="btn-icon">üóëÔ∏è</span>
                      </button>
                    </div>
                  </td>
                </tr>

                <!-- Expanded Detail Row -->
                <tr 
                  class="expanded-row" 
                  *ngIf="student.paymentRecord && expandedStudentId === student._id"
                  [@detailExpand]="'expanded'">
                  <td colspan="8" class="expanded-cell">
                    <div class="expanded-content">
                      <div class="payment-details">
                        
                        <div class="details-header">
                          <h3>D√©tails des Paiements - {{ student.name }}</h3>
                          <div class="details-summary">
                            <span class="summary-item">
                              <strong>Niveau: {{ getClassGrade(student) }}</strong>
                            </span>
                            <span class="summary-item">
                              Ann√©e: {{ student.paymentRecord.academicYear }}
                            </span>
                            <span class="summary-item">
                              Type: {{ student.paymentRecord.paymentType === 'annual' ? 'Paiement Annuel' : 'Paiements Mensuels' }}
                            </span>
                          </div>
                        </div>

                        <!-- Component Summary Cards -->
                        <div class="component-summary-grid">
                          <!-- Tuition Component -->
                          <div class="component-summary-card tuition">
                            <div class="component-header">
                              <span class="component-icon">üìö</span>
                              <h4>Frais Scolaires</h4>
                              <span class="component-status-badge" 
                                    [class]="'status-' + getComponentStatus(student, 'tuition')">
                                {{ getStatusEmoji(getComponentStatus(student, 'tuition')) }}
                              </span>
                            </div>
                            <div class="component-amounts">
                              <div class="amount-line">
                                <span>Total: {{ formatCurrency(getTotalAmounts(student)?.tuition || 0) }}</span>
                              </div>
                              <div class="amount-line">
                                <span>Pay√©: {{ formatCurrency(getPaidAmounts(student)?.tuition || 0) }}</span>
                              </div>
                              <div class="amount-line remaining">
                                <span>Restant: {{ formatCurrency(getRemainingAmounts(student)?.tuition || 0) }}</span>
                              </div>
                            </div>
                          </div>

                          <!-- Uniform Component -->
                          <div class="component-summary-card uniform" *ngIf="hasUniform(student)">
                            <div class="component-header">
                              <span class="component-icon">üëî</span>
                              <h4>Uniforme</h4>
                              <span class="component-status-badge" 
                                    [class]="'status-' + getComponentStatus(student, 'uniform')">
                                {{ getStatusEmoji(getComponentStatus(student, 'uniform')) }}
                              </span>
                            </div>
                            <div class="component-amounts">
                              <div class="amount-line">
                                <span>Total: {{ formatCurrency(getTotalAmounts(student)?.uniform || 0) }}</span>
                              </div>
                              <div class="amount-line">
                                <span>Pay√©: {{ formatCurrency(getPaidAmounts(student)?.uniform || 0) }}</span>
                              </div>
                              <div class="amount-line remaining">
                                <span>Restant: {{ formatCurrency(getRemainingAmounts(student)?.uniform || 0) }}</span>
                              </div>
                            </div>
                          </div>

                          <!-- Transportation Component -->
                          <div class="component-summary-card transportation" *ngIf="hasTransportation(student)">
                            <div class="component-header">
                              <span class="component-icon">üöå</span>
                              <h4>Transport ({{ getTransportationType(student) }})</h4>
                              <span class="component-status-badge" 
                                    [class]="'status-' + getComponentStatus(student, 'transportation')">
                                {{ getStatusEmoji(getComponentStatus(student, 'transportation')) }}
                              </span>
                            </div>
                            <div class="component-amounts">
                              <div class="amount-line">
                                <span>Total: {{ formatCurrency(getTotalAmounts(student)?.transportation || 0) }}</span>
                              </div>
                              <div class="amount-line">
                                <span>Pay√©: {{ formatCurrency(getPaidAmounts(student)?.transportation || 0) }}</span>
                              </div>
                              <div class="amount-line remaining">
                                <span>Restant: {{ formatCurrency(getRemainingAmounts(student)?.transportation || 0) }}</span>
                              </div>
                            </div>
                          </div>
                        </div>
                        
                        <!-- Tuition Monthly Payments Section -->
                        <div class="monthly-payments-section" 
                            *ngIf="student.paymentRecord && student.paymentRecord.tuitionMonthlyPayments && student.paymentRecord.tuitionMonthlyPayments.length > 0">
                          <h4>üìö Calendrier des Paiements Mensuels - Frais Scolaires</h4>
                          <div class="payments-grid">
                            <div 
                              class="payment-month-card" 
                              *ngFor="let payment of student.paymentRecord.tuitionMonthlyPayments; let idx = index; trackBy: trackByPaymentId"
                              [class]="'payment-' + payment.status"
                              [class.overdue]="isPaymentOverdue(payment.dueDate)">
                              
                              <div class="month-header">
                                <div class="month-info">
                                  <span class="month-name">{{ payment.monthName }}</span>
                                  <span class="due-date">√âch√©ance: {{ formatDate(payment.dueDate) }}</span>
                                  <span class="overdue-warning" *ngIf="isPaymentOverdue(payment.dueDate) && payment.status !== 'paid'">
                                    ‚ö†Ô∏è En retard
                                  </span>
                                </div>
                                <span class="status-icon">
                                  {{ getStatusEmoji(payment.status) }}
                                </span>
                              </div>
                              
                              <div class="month-financial">
                                <div class="amount-info">
                                  <span class="amount-due">D√ª: {{ formatCurrency(payment.amount) }}</span>
                                  <span class="amount-paid" *ngIf="payment.paidAmount > 0">
                                    Pay√©: {{ formatCurrency(payment.paidAmount) }}
                                  </span>
                                  <span class="amount-remaining" *ngIf="payment.paidAmount < payment.amount">
                                    Restant: {{ formatCurrency(payment.amount - payment.paidAmount) }}
                                  </span>
                                </div>
                                
                                <div class="payment-info" *ngIf="payment.paymentDate">
                                  <span class="payment-date">{{ formatDate(payment.paymentDate) }}</span>
                                  <span class="payment-method">{{ getPaymentMethodLabel(payment.paymentMethod) }}</span>
                                  <span class="receipt-number" *ngIf="payment.receiptNumber">
                                    Re√ßu: {{ payment.receiptNumber }}
                                  </span>
                                </div>
                              </div>

                              <div class="month-actions" *ngIf="payment.status !== 'paid'">
                                <button 
                                  class="btn btn-small pay-btn"
                                  (click)="openPaymentDialog(student, 'tuition_monthly', idx)">
                                  <span class="btn-icon">üí≥</span>
                                  {{ payment.status === 'partial' ? 'Compl√©ter' : 'Payer' }}
                                </button>
                              </div>
                            </div>
                          </div>
                        </div>

                        <!-- Transportation Monthly Payments Section -->
                        <div class="monthly-payments-section" 
                            *ngIf="hasTransportation(student) && student.paymentRecord && student.paymentRecord.transportation && student.paymentRecord.transportation.monthlyPayments && student.paymentRecord.transportation.monthlyPayments.length > 0">
                          <h4>üöå Calendrier des Paiements Mensuels - Transport</h4>
                          <div class="payments-grid">
                            <div 
                              class="payment-month-card transportation" 
                              *ngFor="let payment of student.paymentRecord.transportation.monthlyPayments; let idx = index; trackBy: trackByPaymentId"
                              [class]="'payment-' + payment.status"
                              [class.overdue]="isPaymentOverdue(payment.dueDate)">
                              
                              <div class="month-header">
                                <div class="month-info">
                                  <span class="month-name">{{ payment.monthName }}</span>
                                  <span class="due-date">√âch√©ance: {{ formatDate(payment.dueDate) }}</span>
                                  <span class="overdue-warning" *ngIf="isPaymentOverdue(payment.dueDate) && payment.status !== 'paid'">
                                    ‚ö†Ô∏è En retard
                                  </span>
                                </div>
                                <span class="status-icon">
                                  {{ getStatusEmoji(payment.status) }}
                                </span>
                              </div>
                              
                              <div class="month-financial">
                                <div class="amount-info">
                                  <span class="amount-due">D√ª: {{ formatCurrency(payment.amount) }}</span>
                                  <span class="amount-paid" *ngIf="payment.paidAmount > 0">
                                    Pay√©: {{ formatCurrency(payment.paidAmount) }}
                                  </span>
                                  <span class="amount-remaining" *ngIf="payment.paidAmount < payment.amount">
                                    Restant: {{ formatCurrency(payment.amount - payment.paidAmount) }}
                                  </span>
                                </div>
                                
                                <div class="payment-info" *ngIf="payment.paymentDate">
                                  <span class="payment-date">{{ formatDate(payment.paymentDate) }}</span>
                                  <span class="payment-method">{{ getPaymentMethodLabel(payment.paymentMethod) }}</span>
                                  <span class="receipt-number" *ngIf="payment.receiptNumber">
                                    Re√ßu: {{ payment.receiptNumber }}
                                  </span>
                                </div>
                              </div>

                              <div class="month-actions" *ngIf="payment.status !== 'paid'">
                                <button 
                                  class="btn btn-small pay-btn transportation"
                                  (click)="openPaymentDialog(student, 'transportation_monthly', idx)">
                                  <span class="btn-icon">üöå</span>
                                  {{ payment.status === 'partial' ? 'Compl√©ter' : 'Payer' }}
                                </button>
                              </div>
                            </div>
                          </div>
                        </div>

                        <!-- Uniform Payment Section -->
                        <div class="uniform-payment-section" *ngIf="hasUniform(student)">
                          <h4>üëî Paiement de l'Uniforme</h4>
                          <div class="uniform-payment-info">
                            <div class="uniform-details" *ngIf="student.paymentRecord && student.paymentRecord.uniform && student.paymentRecord.uniform.isPaid">
                              <div class="payment-success-card">
                                <div class="success-header">
                                  <span class="success-icon">‚úÖ</span>
                                  <span class="success-title">Uniforme pay√©</span>
                                </div>
                                <div class="payment-details-grid">
                                  <span><strong>Date:</strong> {{ safeFormatDate(student.paymentRecord.uniform.paymentDate) }}</span>
                                  <span><strong>M√©thode:</strong> {{ getPaymentMethodLabel(student.paymentRecord.uniform.paymentMethod) }}</span>
                                  <span><strong>Montant:</strong> {{ formatCurrency(student.paymentRecord.uniform.price || 0) }}</span>
                                  <span *ngIf="student.paymentRecord.uniform.receiptNumber">
                                    <strong>Re√ßu:</strong> {{ student.paymentRecord.uniform.receiptNumber }}
                                  </span>
                                  <span *ngIf="student.paymentRecord.uniform.notes">
                                    <strong>Notes:</strong> {{ student.paymentRecord.uniform.notes }}
                                  </span>
                                </div>
                              </div>
                            </div>
                            <div class="uniform-pending" *ngIf="student.paymentRecord && student.paymentRecord.uniform && !student.paymentRecord.uniform.isPaid">
                              <div class="pending-card">
                                <div class="pending-header">
                                  <span class="pending-icon">‚è≥</span>
                                  <span class="pending-title">Paiement en attente</span>
                                </div>
                                <div class="pending-content">
                                  <span class="pending-amount">Montant: {{ formatCurrency(student.paymentRecord.uniform.price || 0) }}</span>
                                  <button 
                                    class="btn btn-primary btn-small"
                                    (click)="openPaymentDialog(student, 'uniform')">
                                    <span class="btn-icon">üëî</span>
                                    Payer l'uniforme
                                  </button>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>

                        <!-- Annual Payment Section -->
                        <div class="annual-payment-section" *ngIf="student.paymentRecord && student.paymentRecord.annualTuitionPayment && student.paymentRecord.annualTuitionPayment.isPaid">
                          <h4>üìã Paiement Annuel des Frais Scolaires</h4>
                          <div class="annual-payment-info">
                            <div class="annual-payment-card">
                              <div class="annual-header">
                                <span class="annual-icon">‚úÖ</span>
                                <span class="annual-title">Paiement annuel effectu√©</span>
                              </div>
                              <div class="annual-details">
                                <span><strong>Date:</strong> {{ safeFormatDate(student.paymentRecord.annualTuitionPayment.paymentDate) }}</span>
                                <span><strong>M√©thode:</strong> {{ getPaymentMethodLabel(student.paymentRecord.annualTuitionPayment.paymentMethod) }}</span>
                                <span *ngIf="student.paymentRecord.annualTuitionPayment.discount">
                                  <strong>Remise:</strong> {{ formatCurrency(student.paymentRecord.annualTuitionPayment.discount || 0) }}
                                </span>
                                <span *ngIf="student.paymentRecord.annualTuitionPayment.receiptNumber">
                                  <strong>Re√ßu:</strong> {{ student.paymentRecord.annualTuitionPayment.receiptNumber }}
                                </span>
                                <span *ngIf="student.paymentRecord.annualTuitionPayment.notes">
                                  <strong>Notes:</strong> {{ student.paymentRecord.annualTuitionPayment.notes }}
                                </span>
                              </div>
                            </div>
                          </div>
                        </div>

                        <!-- Payment Summary -->
                        <div class="payment-summary">
                          <div class="summary-header">
                            <h4>üìä R√©sum√© Financier</h4>
                          </div>
                          <div class="summary-stats">
                            <div class="summary-stat">
                              <span class="stat-label">Montant Total</span>
                              <span class="stat-value">{{ formatCurrency(getTotalAmounts(student)?.grandTotal || 0) }}</span>
                            </div>
                            <div class="summary-stat">
                              <span class="stat-label">Montant Pay√©</span>
                              <span class="stat-value paid">{{ formatCurrency(getPaidAmounts(student)?.grandTotal || 0) }}</span>
                            </div>
                            <div class="summary-stat">
                              <span class="stat-label">Montant Restant</span>
                              <span class="stat-value remaining">{{ formatCurrency(getRemainingAmounts(student)?.grandTotal || 0) }}</span>
                            </div>
                            <div class="summary-stat">
                              <span class="stat-label">Progression</span>
                              <span class="stat-value">{{ calculateProgress(student) }}%</span>
                            </div>
                          </div>
                        </div>

                        <!-- Payment History -->
                        <div class="payment-history-section" *ngIf="getPaymentHistory(student).length > 0">
                          <h4>üìã Historique des Paiements</h4>
                          <div class="payment-history-list">
                            <div 
                              class="payment-history-item" 
                              *ngFor="let historyItem of getPaymentHistory(student); trackBy: trackByHistoryItem">

                              <div class="history-content">
                                <div class="history-main">
                                  <span class="history-amount">{{ formatCurrency(historyItem.amount) }}</span>
                                  <span class="history-type" *ngIf="historyItem.month">({{ historyItem.month }})</span>
                                </div>
                                <div class="history-details">
                                  <span class="history-date">{{ formatDate(historyItem.date) }}</span>
                                  <span class="history-method">{{ getPaymentMethodLabel(historyItem.method) }}</span>
                                  <span class="history-receipt" *ngIf="historyItem.receiptNumber">
                                    Re√ßu: {{ historyItem.receiptNumber }}
                                  </span>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </td>
                </tr>
              </ng-container>
            </tbody>
          </table>

          <!-- No Data State -->
          <div class="no-data-state" *ngIf="!isLoading && students.length === 0">
            <div class="no-data-content">
              <span class="no-data-icon">üéì</span>
              <h3>Aucun √©tudiant trouv√©</h3>
              <p *ngIf="hasActiveFilters()">Essayez de modifier vos filtres de recherche</p>
              <p *ngIf="!hasActiveFilters()">Aucun √©tudiant n'est encore inscrit</p>
              <button class="btn btn-primary" (click)="clearFilters()" *ngIf="hasActiveFilters()">
                Effacer les filtres
              </button>
            </div>
          </div>
        </div>

        <!-- Pagination -->
        <div class="table-footer">
          <div class="pagination">
            <button 
              class="pagination-btn"
              [disabled]="currentPage <= 1"
              (click)="goToPage(currentPage - 1)">
              ‚óÄÔ∏è Pr√©c√©dent
            </button>
            
            <span class="pagination-info">
              Page {{ currentPage }} sur {{ totalPages }}
              ({{ totalStudents }} √©tudiants au total)
            </span>
            
            <button 
              class="pagination-btn"
              [disabled]="currentPage >= totalPages"
              (click)="goToPage(currentPage + 1)">
              Suivant ‚ñ∂Ô∏è
            </button>
          </div>
          
          <div class="page-size-selector">
            <label for="pageSize">√âl√©ments par page:</label>
            <select 
              id="pageSize"
              [value]="pageSize"
              (change)="onPageSizeChange($event)"
              class="page-size-select">
              <option value="25">25</option>
              <option value="50">50</option>
              <option value="100">100</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Generate Payment Dialog Modal -->
  <div class="modal-overlay" *ngIf="isGenerateDialogOpen" (click)="closeGenerateDialog()">
    <div class="modal-container generate-dialog" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>G√©n√©rer Dossier de Paiement</h3>
        <button class="close-btn" (click)="closeGenerateDialog()">‚úñÔ∏è</button>
      </div>
      
      <div class="modal-body" *ngIf="selectedStudent">
        <div class="student-info">
          <h4>{{ selectedStudent.name }}</h4>
          <p>{{ getClassGrade(selectedStudent) }} - {{ getClassName(selectedStudent) }}</p>
        </div>
        
        <form [formGroup]="generateForm" (ngSubmit)="generatePaymentRecord()">
          <div class="form-section">
            <h5>üí∞ Frais Scolaires</h5>
            <p>Les frais scolaires sont inclus automatiquement selon le niveau de l'√©tudiant.</p>
            <div class="tuition-info">
              <span>Montant: {{ formatCurrency(getTuitionAmountForGrade(selectedStudent.grade)) }}</span>
            </div>
          </div>

          <div class="form-section">
            <h5>üëî Uniforme</h5>
            <div class="checkbox-group">
              <label class="checkbox-label">
                <input 
                  type="checkbox" 
                  formControlName="hasUniform"
                  class="checkbox-input">
                <span class="checkbox-custom"></span>
                Inclure l'uniforme
              </label>
            </div>
            <div class="uniform-info" *ngIf="generateForm.get('hasUniform')?.value && isUniformEnabled()">
              <span>Prix: {{ formatCurrency(getUniformPrice()) }}</span>
              <p class="info-text" *ngIf="getUniformDescription()">{{ getUniformDescription() }}</p>
            </div>
          </div>

          <div class="form-section">
            <h5>üöå Transport</h5>
            <div class="radio-group">
              <label class="radio-label">
                <input 
                  type="radio" 
                  formControlName="transportationType"
                  value=""
                  class="radio-input">
                <span class="radio-custom"></span>
                Pas de transport
              </label>
              
              <label class="radio-label" *ngIf="isTransportationCloseEnabled()">
                <input 
                  type="radio" 
                  formControlName="transportationType"
                  value="close"
                  class="radio-input">
                <span class="radio-custom"></span>
                Zone proche
                <span class="price-info">{{ formatCurrency(getTransportationMonthlyPrice('close')) }}/mois</span>
              </label>
              
              <label class="radio-label" *ngIf="isTransportationFarEnabled()">
                <input 
                  type="radio" 
                  formControlName="transportationType"
                  value="far"
                  class="radio-input">
                <span class="radio-custom"></span>
                Zone √©loign√©e
                <span class="price-info">{{ formatCurrency(getTransportationMonthlyPrice('far')) }}/mois</span>
              </label>
            </div>
            <div class="transport-info" *ngIf="generateForm.get('transportationType')?.value">
              <p class="info-text">{{ getTransportDescription(generateForm.get('transportationType')?.value) }}</p>
            </div>
          </div>

          <div class="form-section total-section">
            <div class="total-calculation">
              <h5>üí∏ Total Estim√©</h5>
              <div class="calculation-breakdown">
                <div class="calc-line">
                  <span>Frais scolaires:</span>
                  <span>{{ formatCurrency(getTuitionAmountForGrade(selectedStudent.grade)) }}</span>
                </div>
                <div class="calc-line" *ngIf="generateForm.get('hasUniform')?.value">
                  <span>Uniforme:</span>
                  <span>{{ formatCurrency(getUniformPrice()) }}</span>
                </div>
                <div class="calc-line" *ngIf="generateForm.get('transportationType')?.value">
                  <span>Transport ({{ getTransportationMonths() }} mois):</span>
                  <span>{{ formatCurrency(getTransportationTotal()) }}</span>
                </div>
                <div class="calc-line total-line">
                  <strong>Total:</strong>
                  <strong>{{ formatCurrency(calculateEstimatedTotal()) }}</strong>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
      
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeGenerateDialog()">
          Annuler
        </button>
        <button 
          class="btn btn-primary" 
          (click)="generatePaymentRecord()"
          [disabled]="isLoading">
          <span *ngIf="isLoading">G√©n√©ration...</span>
          <span *ngIf="!isLoading">G√©n√©rer le dossier</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Payment Dialog Modal -->
  <div class="modal-overlay" *ngIf="isPaymentDialogOpen" (click)="closePaymentDialog()">
    <div class="modal-container" (click)="$event.stopPropagation()">
      <app-payment-dialog
        *ngIf="currentDialogData"
        [data]="currentDialogData"
        (dialogClosed)="closePaymentDialog($event)">
      </app-payment-dialog>
    </div>
  </div>

  <!-- Edit Payment Record Modal -->
  <div class="modal-overlay" *ngIf="isEditDialogOpen" (click)="closeEditDialog()">
  <div class="modal-container edit-dialog" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Modifier les Composants du Dossier</h3>
      <button class="close-btn" (click)="closeEditDialog()">‚úñÔ∏è</button>
    </div>
    
    <div class="modal-body" *ngIf="selectedStudent">
      <div class="student-info">
        <h4>{{ selectedStudent.name }}</h4>
        <p>{{ getClassGrade(selectedStudent) }} - {{ getClassName(selectedStudent) }}</p>
        <div class="current-amounts" *ngIf="selectedStudent.paymentRecord">
          <span class="amount-display">
            Total actuel: {{ formatCurrency(getTotalAmounts(selectedStudent)?.grandTotal || 0) }}
          </span>
        </div>
      </div>
      
      <form [formGroup]="editForm" (ngSubmit)="onEditFormSubmit()">
<div class="form-section">
  <h5>üëî Uniforme</h5>
  <div class="checkbox-group">
    <label class="checkbox-label">
      <input 
        type="checkbox" 
        formControlName="hasUniform"
        class="checkbox-input"
        [disabled]="isUniformPaid(selectedStudent!)">
      <span class="checkbox-custom"></span>
      Inclure l'uniforme
      <span class="price-info" *ngIf="isUniformEnabled() && editForm.get('hasUniform')?.value">
        - {{ formatCurrency(getUniformPrice(selectedStudent)) }}
      </span>
    </label>
  </div>
  
  <!-- Uniform Status Display -->
  <div class="component-status-info" *ngIf="selectedStudent && selectedStudent.paymentRecord?.uniform">
    <div class="status-paid" *ngIf="isUniformPaid(selectedStudent)">
      <span class="status-icon">‚úÖ</span>
      <span>Uniforme d√©j√† pay√© le {{ safeFormatDate(getUniformPaymentDate(selectedStudent)) }}</span>
    </div>
    <div class="status-pending" *ngIf="isUniformPurchased(selectedStudent) && !isUniformPaid(selectedStudent)">
      <span class="status-icon">‚è≥</span>
      <span>Uniforme command√© - {{ formatCurrency(getUniformPrice(selectedStudent)) }} en attente</span>
    </div>
  </div>
  
  <!-- Warning for uniform removal -->
  <div class="warning-message" *ngIf="selectedStudent && isUniformPaid(selectedStudent) && !editForm.get('hasUniform')?.value">
    <span class="warning-icon">‚ö†Ô∏è</span>
    <span>Impossible de retirer l'uniforme car il a d√©j√† √©t√© pay√©</span>
  </div>
</div>

      <div class="form-section">
  <h5>üöå Transport</h5>
  <div class="radio-group">
    <label class="radio-label">
      <input 
        type="radio" 
        formControlName="transportationType"
        value=""
        class="radio-input">
      <span class="radio-custom"></span>
      Pas de transport
    </label>
    
    <label class="radio-label" *ngIf="isTransportationCloseEnabled()">
      <input 
        type="radio" 
        formControlName="transportationType"
        value="close"
        class="radio-input"
        [disabled]="selectedStudent && hasTransportationPaymentsForStudent(selectedStudent, 'far')">
      <span class="radio-custom"></span>
      Zone proche
      <span class="price-info">{{ formatCurrency(getTransportationMonthlyPrice('close')) }}/mois</span>
    </label>
    
    <label class="radio-label" *ngIf="isTransportationFarEnabled()">
      <input 
        type="radio" 
        formControlName="transportationType"
        value="far"
        class="radio-input"
        [disabled]="selectedStudent && hasTransportationPaymentsForStudent(selectedStudent, 'close')">
      <span class="radio-custom"></span>
      Zone √©loign√©e
      <span class="price-info">{{ formatCurrency(getTransportationMonthlyPrice('far')) }}/mois</span>
    </label>
  </div>
  
  <!-- Transportation Status Display -->
  <div class="component-status-info" *ngIf="selectedStudent && isUsingTransportation(selectedStudent)">
    <div class="transport-current-info">
      <span class="status-icon">üöå</span>
      <span>Type actuel: {{ getTransportationType(selectedStudent) }}</span>
      <div class="payment-progress" *ngIf="hasTransportationMonthlyPayments(selectedStudent)">
        <span>Paiements effectu√©s: {{ getTransportationPaidPayments() }} / {{ getTransportationTotalPayments() }}</span>
      </div>
    </div>
  </div>
  
  <!-- Warning for transportation type change -->
  <div class="warning-message" *ngIf="selectedStudent && hasTransportationPaymentsForStudent(selectedStudent) && isChangingTransportationType()">
    <span class="warning-icon">‚ö†Ô∏è</span>
    <span>Attention: Des paiements de transport ont d√©j√† √©t√© effectu√©s</span>
  </div>
</div>

        <!-- Estimated Total Changes -->
        <div class="form-section total-section" *ngIf="hasChanges()">
          <div class="total-comparison">
            <h5>üí∏ Impact des Modifications</h5>
            <div class="comparison-grid">
              <div class="comparison-line">
                <span class="label">Total actuel:</span>
                <span class="amount current">{{ formatCurrency(getCurrentTotal()) }}</span>
              </div>
              <div class="comparison-line">
                <span class="label">Nouveau total:</span>
                <span class="amount new">{{ formatCurrency(getNewTotal()) }}</span>
              </div>
              <div class="comparison-line difference">
                <span class="label">Diff√©rence:</span>
                <span class="amount" [class.positive]="getTotalDifference() > 0" [class.negative]="getTotalDifference() < 0">
                  {{ getTotalDifference() > 0 ? '+' : '' }}{{ formatCurrency(getTotalDifference()) }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
    
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeEditDialog()">
        Annuler
      </button>
      <button 
        class="btn btn-primary" 
        (click)="onEditFormSubmit()"
        [disabled]="isLoading || !hasChanges() || !editForm.valid">
        <span *ngIf="isLoading">
          <span class="spinner-small"></span>
          Mise √† jour...
        </span>
        <span *ngIf="!isLoading">
          Mettre √† jour
        </span>
      </button>
    </div>
  </div>
</div>
<!-- Invoice Dialog Modal -->
  <div class="modal-overlay" *ngIf="isInvoiceDialogOpen" (click)="closeInvoiceDialog()">
    <div class="modal-container" (click)="$event.stopPropagation()">
      <app-invoice-dialog
        *ngIf="selectedStudentForInvoice"
        [student]="selectedStudentForInvoice"
        [academicYear]="currentAcademicYear"
        (dialogClosed)="closeInvoiceDialog()">
      </app-invoice-dialog>
    </div>
  </div>

  <!-- Confirmation Modal -->
  <div class="modal-overlay" *ngIf="confirmationState.isOpen" [@fadeIn] (click)="onConfirmationCancel()">
    <div class="modal-container" (click)="$event.stopPropagation()" [@slideIn]>
      <div class="modal-header" [class]="'modal-header-' + (confirmationState.config?.type || 'info')">
        <div class="modal-icon">
          <span>{{ confirmationState.config?.icon || getDefaultConfirmationIcon() }}</span>
        </div>
        <h3 class="modal-title">{{ confirmationState.config?.title || 'Confirmation' }}</h3>
      </div>
      
      <div class="modal-body">
        <p class="modal-message">{{ confirmationState.config?.message }}</p>
      </div>
      
      <div class="modal-footer">
        <button 
          class="btn btn-secondary" 
          (click)="onConfirmationCancel()"
          type="button">
          {{ confirmationState.config?.cancelText || 'Annuler' }}
        </button>
        <button 
          class="btn"
          [class]="'btn-' + (confirmationState.config?.type || 'primary')"
          (click)="onConfirmationConfirm()"
          type="button">
          {{ confirmationState.config?.confirmText || 'Confirmer' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Toaster Container -->
  <div class="toaster-container">
    <div *ngFor="let toast of toasts" 
         class="toast" 
         [class]="'toast-' + toast.type"
         [@slideInOut]>
      <div class="toast-content">
        <div class="toast-icon">
          <!-- Success Icon -->
          <svg *ngIf="toast.type === 'success'" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
          <!-- Error Icon -->
          <svg *ngIf="toast.type === 'error'" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <line x1="15" y1="9" x2="9" y2="15"/>
            <line x1="9" y1="9" x2="15" y2="15"/>
          </svg>
          <!-- Warning Icon -->
          <svg *ngIf="toast.type === 'warning'" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
            <line x1="12" y1="9" x2="12" y2="13"/>
            <line x1="12" y1="17" x2="12.01" y2="17"/>
          </svg>
          <!-- Info Icon -->
          <svg *ngIf="toast.type === 'info'" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <line x1="12" y1="16" x2="12" y2="12"/>
            <line x1="12" y1="8" x2="12.01" y2="8"/>
          </svg>
        </div>
        <div class="toast-message">
          <div class="toast-title" *ngIf="toast.title">{{ toast.title }}</div>
          <div class="toast-text">{{ toast.message }}</div>
        </div>
        <button class="toast-close" (click)="removeToast(toast.id)">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
    </div>
  </div>
</div>