<!-- payment-config.component.html -->
<div class="payment-config-container">
  <!-- Header Section -->
  <header class="config-header">
    <div class="header-content">
      <div class="title-section">
        <h1 class="page-title">
          <span class="title-icon">‚öôÔ∏è</span>
          Configuration des Paiements
        </h1>
        <p class="page-subtitle">Configurez les montants et param√®tres de paiement pour votre √©tablissement</p>
      </div>
      <button class="btn btn-back" (click)="onCancel()">
        <span class="btn-icon">‚¨ÖÔ∏è</span>
        Retour
      </button>
    </div>
  </header>

  <!-- Main Configuration Content -->
  <div class="config-content">
    <form [formGroup]="configForm" (ngSubmit)="onSubmit()" class="config-form">
      
      <!-- Academic Year Selection -->
      <section class="config-section academic-year-section">
        <div class="section-header">
          <h2 class="section-title">
            <span class="section-icon">üéì</span>
            Ann√©e Acad√©mique
          </h2>
        </div>
        
        <div class="form-group">
          <label for="academicYear" class="form-label">S√©lectionner l'ann√©e acad√©mique</label>
          <select 
            id="academicYear"
            [value]="configForm.get('academicYear')?.value"
            (change)="onAcademicYearChange($event)"
            class="form-select academic-year-select">
            <option *ngFor="let year of academicYears" [value]="year">
              {{ year }}
            </option>
          </select>
          <p class="form-hint">Configuration pour l'ann√©e scolaire s√©lectionn√©e</p>
        </div>
      </section>

      <!-- Payment Amounts Section -->
      <section class="config-section amounts-section">
        <div class="section-header">
          <h2 class="section-title">
            <span class="section-icon">üí∞</span>
            Montants des Frais de Scolarit√©
          </h2>
          <p class="section-description">D√©finissez les frais annuels pour chaque niveau d'√©tude</p>
        </div>
        
        <div formGroupName="paymentAmounts" class="amounts-grid">
          <!-- √âcole Card -->
          <div class="amount-card ecole-card">
            <div class="card-header">
              <div class="card-icon ecole-icon">üè´</div>
              <div class="card-title">
                <h3>√âcole</h3>
                <p>Classes: 6√®me, 5√®me, 4√®me, 3√®me, 2nde, 1√®re</p>
              </div>
            </div>
            
            <div class="card-content">
              <div class="form-group">
                <label for="ecole" class="form-label">Montant annuel</label>
                <div class="input-group">
                  <span class="input-prefix">TND</span>
                  <input 
                    id="ecole"
                    type="number" 
                    formControlName="√©cole" 
                    min="0"
                    class="form-input amount-input"
                    placeholder="0">
                </div>
                <div class="field-error" *ngIf="isFieldInvalid('paymentAmounts.√©cole')">
                  {{ getFieldError('paymentAmounts.√©cole') }}
                </div>
              </div>
              
              <div class="monthly-calculation">
                <span class="monthly-label">Mensualit√©:</span>
                <span class="monthly-amount">{{ formatCurrency(calculateMonthlyAmount('√©cole')) }}</span>
              </div>
            </div>
          </div>

          <!-- Coll√®ge Card -->
          <div class="amount-card college-card">
            <div class="card-header">
              <div class="card-icon college-icon">üìö</div>
              <div class="card-title">
                <h3>Coll√®ge</h3>
                <p>Classes: 9√®me, 8√®me, 7√®me</p>
              </div>
            </div>
            
            <div class="card-content">
              <div class="form-group">
                <label for="college" class="form-label">Montant annuel</label>
                <div class="input-group">
                  <span class="input-prefix">TND</span>
                  <input 
                    id="college"
                    type="number" 
                    formControlName="college" 
                    min="0"
                    class="form-input amount-input"
                    placeholder="0">
                </div>
                <div class="field-error" *ngIf="isFieldInvalid('paymentAmounts.college')">
                  {{ getFieldError('paymentAmounts.college') }}
                </div>
              </div>
              
              <div class="monthly-calculation">
                <span class="monthly-label">Mensualit√©:</span>
                <span class="monthly-amount">{{ formatCurrency(calculateMonthlyAmount('college')) }}</span>
              </div>
            </div>
          </div>

          <!-- Lyc√©e Card -->
          <div class="amount-card lycee-card">
            <div class="card-header">
              <div class="card-icon lycee-icon">üß™</div>
              <div class="card-title">
                <h3>Lyc√©e</h3>
                <p>Classes: 4·µâ, 3·µâ, 2·µâ, 1 ≥·µâ ann√©e S</p>
              </div>
            </div>
            
            <div class="card-content">
              <div class="form-group">
                <label for="lycee" class="form-label">Montant annuel</label>
                <div class="input-group">
                  <span class="input-prefix">TND</span>
                  <input 
                    id="lycee"
                    type="number" 
                    formControlName="lyc√©e" 
                    min="0"
                    class="form-input amount-input"
                    placeholder="0">
                </div>
                <div class="field-error" *ngIf="isFieldInvalid('paymentAmounts.lyc√©e')">
                  {{ getFieldError('paymentAmounts.lyc√©e') }}
                </div>
              </div>
              
              <div class="monthly-calculation">
                <span class="monthly-label">Mensualit√©:</span>
                <span class="monthly-amount">{{ formatCurrency(calculateMonthlyAmount('lyc√©e')) }}</span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Payment Schedule Section -->
      <section class="config-section schedule-section">
        <div class="section-header">
          <h2 class="section-title">
            <span class="section-icon">üìÖ</span>
            Calendrier de Paiement
          </h2>
          <p class="section-description">D√©finissez la p√©riode de paiement pour l'ann√©e scolaire</p>
        </div>
        
        <div formGroupName="paymentSchedule" class="schedule-container">
          <div class="schedule-inputs">
            <div class="form-group">
              <label for="startMonth" class="form-label">Mois de d√©but</label>
              <div class="input-group">
                <span class="input-prefix">üìÖ</span>
                <select 
                  id="startMonth"
                  formControlName="startMonth"
                  class="form-select">
                  <option *ngFor="let month of months" [value]="month.value">
                    {{ month.label }}
                  </option>
                </select>
              </div>
              <div class="field-error" *ngIf="isFieldInvalid('paymentSchedule.startMonth')">
                {{ getFieldError('paymentSchedule.startMonth') }}
              </div>
            </div>

            <div class="form-group">
              <label for="endMonth" class="form-label">Mois de fin</label>
              <div class="input-group">
                <span class="input-prefix">üìÖ</span>
                <select 
                  id="endMonth"
                  formControlName="endMonth"
                  class="form-select">
                  <option *ngFor="let month of months" [value]="month.value">
                    {{ month.label }}
                  </option>
                </select>
              </div>
              <div class="field-error" *ngIf="isFieldInvalid('paymentSchedule.endMonth')">
                {{ getFieldError('paymentSchedule.endMonth') }}
              </div>
            </div>
          </div>

          <div class="schedule-summary">
            <div class="summary-card">
              <div class="summary-icon">üìä</div>
              <div class="summary-content">
                <span class="summary-label">Nombre total de mois</span>
                <span class="summary-value">{{ calculateTotalMonths() }} mois</span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Grace Period Section -->
      <section class="config-section grace-period-section">
        <div class="section-header">
          <h2 class="section-title">
            <span class="section-icon">‚è∞</span>
            P√©riode de Gr√¢ce
          </h2>
          <p class="section-description">D√©lai accord√© apr√®s la date d'√©ch√©ance avant de marquer un paiement en retard</p>
        </div>
        
        <div class="form-group grace-period-group">
          <label for="gracePeriod" class="form-label">D√©lai de gr√¢ce (jours)</label>
          <div class="input-group">
            <span class="input-prefix">‚è≥</span>
            <input 
              id="gracePeriod"
              type="number" 
              formControlName="gracePeriod" 
              min="0" 
              max="30"
              class="form-input"
              placeholder="5">
            <span class="input-suffix">jours</span>
          </div>
          <p class="form-hint">Nombre de jours apr√®s la date d'√©ch√©ance avant de marquer comme en retard (0-30 jours)</p>
          <div class="field-error" *ngIf="isFieldInvalid('gracePeriod')">
            {{ getFieldError('gracePeriod') }}
          </div>
        </div>
      </section>

      <!-- Annual Payment Discount Section -->
      <section class="config-section discount-section">
        <div class="section-header">
          <h2 class="section-title">
            <span class="section-icon">üè∑Ô∏è</span>
            Remise pour Paiement Annuel
          </h2>
          <p class="section-description">Encouragez les paiements annuels avec une remise attractive</p>
        </div>
        
        <div formGroupName="annualPaymentDiscount" class="discount-container">
          <div class="discount-toggle">
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                formControlName="enabled"
                class="checkbox-input">
              <span class="checkbox-custom"></span>
              <span class="checkbox-text">Activer la remise pour paiement annuel</span>
            </label>
          </div>

          <div class="discount-fields" *ngIf="configForm.get('annualPaymentDiscount.enabled')?.value">
            <div class="discount-options">
              <div class="form-group">
                <label for="discountPercentage" class="form-label">Pourcentage de remise</label>
                <div class="input-group">
                  <span class="input-prefix">%</span>
                  <input 
                    id="discountPercentage"
                    type="number" 
                    formControlName="percentage" 
                    min="0" 
                    max="100"
                    class="form-input"
                    placeholder="0">
                  <span class="input-suffix">%</span>
                </div>
                <div class="field-error" *ngIf="isFieldInvalid('annualPaymentDiscount.percentage')">
                  {{ getFieldError('annualPaymentDiscount.percentage') }}
                </div>
              </div>

              <div class="or-divider">
                <span class="or-text">OU</span>
              </div>

              <div class="form-group">
                <label for="discountAmount" class="form-label">Montant fixe de remise</label>
                <div class="input-group">
                  <span class="input-prefix">TND</span>
                  <input 
                    id="discountAmount"
                    type="number" 
                    formControlName="amount" 
                    min="0"
                    class="form-input"
                    placeholder="0">
                </div>
                <div class="field-error" *ngIf="isFieldInvalid('annualPaymentDiscount.amount')">
                  {{ getFieldError('annualPaymentDiscount.amount') }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Current Configuration Summary -->
      <section class="config-section summary-section" *ngIf="currentConfig">
        <div class="section-header">
          <h2 class="section-title">
            <span class="section-icon">‚ÑπÔ∏è</span>
            Configuration Actuelle
          </h2>
        </div>
        
        <div class="summary-grid">
          <div class="summary-item">
            <span class="summary-label">Derni√®re modification:</span>
            <span class="summary-value">{{ formatDate(currentConfig.updatedAt) }}</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Statut:</span>
            <span class="summary-value">
              <span [class]="'status-badge ' + (currentConfig.isActive ? 'active' : 'inactive')">
                {{ currentConfig.isActive ? 'Active' : 'Inactive' }}
              </span>
            </span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Cr√©√© par:</span>
            <span class="summary-value">{{ getCreatedByName(currentConfig.createdBy) }}</span>
          </div>
        </div>
      </section>

      <!-- Action Buttons -->
      <div class="actions-section">
        <button type="button" class="btn btn-secondary" (click)="onCancel()" [disabled]="isLoading">
          Annuler
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="configForm.invalid || isLoading">
          <span class="btn-spinner" *ngIf="isLoading">‚è≥</span>
          <span *ngIf="!isLoading">üíæ Enregistrer la Configuration</span>
          <span *ngIf="isLoading">Enregistrement...</span>
        </button>
      </div>
    </form>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" *ngIf="isLoading">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p>Chargement en cours...</p>
    </div>
  </div>
</div>