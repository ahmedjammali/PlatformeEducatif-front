<!-- invoice.component.html -->
<div class="invoice-container" *ngIf="invoiceData">
  <div class="invoice-actions no-print">
    <button 
      class="btn btn-primary download-btn" 
      (click)="downloadPDF()"
      [disabled]="isGeneratingPdf">
      <span class="btn-icon" *ngIf="!isGeneratingPdf">üì•</span>
      <span class="spinner" *ngIf="isGeneratingPdf">‚è≥</span>
      {{ isGeneratingPdf ? 'G√©n√©ration...' : 'T√©l√©charger PDF' }}
    </button>
  </div>

  <!-- Invoice Content -->
  <div class="invoice-content">
    <!-- Header -->
    <div class="invoice-header">
      <div class="school-info">
        <h1 class="school-name">{{ invoiceData.schoolInfo.name }}</h1>
        <div class="school-details">
          <p>{{ invoiceData.schoolInfo.address }}</p>
          <p>T√©l: {{ invoiceData.schoolInfo.phone }}</p>
          <p>Email: {{ invoiceData.schoolInfo.email }}</p>
        </div>
      </div>
      <div class="invoice-meta">
        <div class="code-tva">
          <strong>Code TVA :</strong> 1641042J
        </div>
      </div>
    </div>

    <!-- Student Information Box -->
    <div class="student-box">
      <div class="student-row">
        <span class="student-label">Doit :</span>
        <span>{{ invoiceData.student._id || '000000' | slice:0:8 }} {{ invoiceData.student.name | uppercase }}</span>
      </div>
      <div class="student-row">
        <span class="student-label">Matricule Fiscal :</span>
        <span>-</span>
      </div>
      <div class="student-row">
        <span class="student-label">Mode de paiement :</span>
        <span>Mixte</span>
      </div>
    </div>

    <!-- Invoice Details Box -->
    <div class="invoice-details-box">
      <div class="invoice-details-header">
        <span class="facture-title">B.L. FACTURE</span>
        <span class="page-info">Page 1/1</span>
      </div>
      <div class="invoice-details-content">
        <div class="details-row">
          <span class="details-label">Num√©ro :</span>
          <span>{{ invoiceData.invoiceNumber.split('-')[2] || '0001156' }}</span>
        </div>
        <div class="details-row">
          <span class="details-label">Date :</span>
          <span>{{ formatDateShort(invoiceData.generatedDate) }}</span>
        </div>
        <div class="details-row">
          <span class="details-label">√âch√©ance :</span>
          <span>{{ formatDateShort(invoiceData.generatedDate) }}</span>
        </div>
      </div>
    </div>

    <!-- Main Table -->
    <table class="main-table">
      <thead>
        <tr>
          <th class="ref-col">R√©f√©rence</th>
          <th class="designation-col">D√©signation</th>
          <th class="qty-col">Qt√©</th>
          <th class="price-col">Prix HT</th>
          <th class="amount-col">Montant HT</th>
          <th class="tva-col">TVA</th>
        </tr>
      </thead>
      <tbody>
        <!-- Tuition Fee Row -->
        <tr class="payment-row">
          <td>001</td>
          <td class="designation-col">
            <span class="service-icon">üìö</span>
            FRAIS SCOLAIRES - ANN√âE ACAD√âMIQUE {{ invoiceData.academicYear }}
          </td>
          <td>1,00</td>
          <td class="price-col">{{ formatCurrencyTable(invoiceData.totals.tuition + invoiceData.remainingAmounts.tuition) }}</td>
          <td class="amount-col" [class.amount-positive]="invoiceData.totals.tuition > 0" [class.amount-pending]="invoiceData.remainingAmounts.tuition > 0">
            {{ formatCurrencyTable(invoiceData.totals.tuition) }}
          </td>
          <td>0,00</td>
        </tr>

        <!-- Uniform Row (if applicable) -->
        <tr class="payment-row" *ngIf="hasUniform()">
          <td>002</td>
          <td class="designation-col">
            <span class="service-icon">üëî</span>
            UNIFORME SCOLAIRE
          </td>
          <td>1,00</td>
          <td class="price-col">{{ formatCurrencyTable(invoiceData.totals.uniform + invoiceData.remainingAmounts.uniform) }}</td>
          <td class="amount-col" [class.amount-positive]="invoiceData.totals.uniform > 0" [class.amount-pending]="invoiceData.remainingAmounts.uniform > 0">
            {{ formatCurrencyTable(invoiceData.totals.uniform) }}
          </td>
          <td>0,00</td>
        </tr>

        <!-- Transportation Row (if applicable) -->
        <tr class="payment-row" *ngIf="hasTransportation()">
          <td>{{ hasUniform() ? '003' : '002' }}</td>
          <td class="designation-col">
            <span class="service-icon">üöå</span>
            TRANSPORT - {{ getTransportationType() | uppercase }}
          </td>
          <td>1,00</td>
          <td class="price-col">{{ formatCurrencyTable(invoiceData.totals.transportation + invoiceData.remainingAmounts.transportation) }}</td>
          <td class="amount-col" [class.amount-positive]="invoiceData.totals.transportation > 0" [class.amount-pending]="invoiceData.remainingAmounts.transportation > 0">
            {{ formatCurrencyTable(invoiceData.totals.transportation) }}
          </td>
          <td>0,00</td>
        </tr>

        <!-- Empty rows for spacing -->
        <ng-container *ngFor="let i of getEmptyRows()">
          <tr class="payment-row">
            <td></td>
            <td class="designation-col"></td>
            <td></td>
            <td class="price-col"></td>
            <td class="amount-col"></td>
            <td></td>
          </tr>
        </ng-container>
      </tbody>
    </table>

    <!-- Totals Section -->
    <div class="totals-section">
      <div class="tva-box">
        <table class="tva-table">
          <thead>
            <tr>
              <th>Base</th>
              <th>TVA%</th>
              <th>TVA</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>{{ formatCurrencyTable(invoiceData.totals.grandTotal) }}</td>
              <td>0,00</td>
              <td>0,00</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="totals-box">
        <div class="total-line total-ht">
          <strong>Total H.T</strong>
          <span class="total-amount">{{ formatCurrencyTable(invoiceData.totals.grandTotal) }}</span>
        </div>
        <div class="total-line">
          <strong>T.V.A.</strong>
          <span class="total-amount">0,00</span>
        </div>
        <div class="total-line">
          <strong>Timbre fiscal</strong>
          <span class="total-amount">0,00</span>
        </div>
        <div class="total-line total-ttc">
          <strong>Total TTC</strong>
          <span class="total-amount">{{ formatCurrencyTable(invoiceData.totals.grandTotal) }}</span>
        </div>
      </div>
    </div>

    <!-- Payment History Section (if needed) -->
    <div class="payment-history-section" *ngIf="showPaymentHistory && invoiceData.payments.length > 0">
      <h3>D√©tail des Paiements</h3>
      <table class="payment-history-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Service</th>
            <th>Montant</th>
            <th>M√©thode</th>
            <th>N¬∞ Re√ßu</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let payment of invoiceData.payments">
            <td>{{ formatDateShort(payment.date) }}</td>
            <td>{{ getComponentLabel(payment.component) }}</td>
            <td>{{ formatCurrencyTable(payment.amount) }}</td>
            <td>{{ getPaymentMethodLabel(payment.method) }}</td>
            <td>{{ payment.receiptNumber || '-' }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Footer -->
    <div class="footer-section">
      <div class="amount-words">
        <strong>Arr√™t√©e la pr√©sente B.L. Facture √† la somme de :</strong><br>
        {{ convertAmountToWords(invoiceData.totals.grandTotal) | uppercase }}
      </div>
      <div class="signature-section">
        <div class="signature-label"><strong>Signature</strong></div>
        <div class="signature-box">
          <!-- Optional: Add school stamp/logo here -->
        </div>
      </div>
    </div>
  </div>
</div>