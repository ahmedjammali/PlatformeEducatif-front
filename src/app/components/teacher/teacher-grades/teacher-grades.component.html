<!-- teacher-grades.component.html - FIXED VERSION -->
<section class="content-section grades-section">
  <div class="section-header">
    <h2 class="section-title">Gestion des Notes</h2>
    <div class="header-actions">

      <button 
        class="create-btn"
        (click)="openCreateGradeForm()"
        [disabled]="!filters.selectedClass || !filters.selectedSubject">
        <span class="btn-icon">‚ûï</span>
        Ajouter une Note
      </button>
      <button 
        class="bulk-btn"
        (click)="openBulkGradeForm()"
        [disabled]="!filters.selectedClass || !filters.selectedSubject">
        <span class="btn-icon">üìä</span>
        Saisie Group√©e
      </button>
    </div>
  </div>

  <!-- Barre de filtres -->
  <div class="filters-bar">
    <div class="filters-header">
      <h3 class="filters-title">
        Filtres
      </h3>
      <button 
        class="reset-filters-btn"
        (click)="resetFilters()"
        [disabled]="!hasActiveFilters()"
        title="R√©initialiser tous les filtres">
        <span class="reset-icon">üîÑ</span>
        R√©initialiser les filtres
      </button>
    </div>
    
    <div class="filters-container">
      <div class="filter-group primary">
        <label for="class-select">
          Classe *
        </label>
        <div class="filter-input-wrapper">
          <span class="filter-icon">üè´</span>
          <select 
            id="class-select"
            class="filter-select"
            [(ngModel)]="filters.selectedClass"
            (change)="onFilterChange()">
            <option value="">S√©lectionner une classe</option>
            <option *ngFor="let class of classes" [value]="class._id">
              {{ class.name }} - {{ class.grade }}
            </option>
          </select>
        </div>
        <small class="filter-help" *ngIf="!filters.selectedClass">
          S√©lectionnez une classe pour commencer
        </small>
      </div>

      <div class="filter-group" [class.disabled]="!filters.selectedClass">
        <label for="subject-select">
          Mati√®re
        </label>
        <div class="filter-input-wrapper">
          <span class="filter-icon">üìö</span>
          <select 
            id="subject-select"
            class="filter-select"
            [(ngModel)]="filters.selectedSubject"
            (change)="onFilterChange()"
            [disabled]="!filters.selectedClass">
            <option value="">
              {{ !filters.selectedClass ? 'S√©lectionnez d\'abord une classe' : 'Toutes les mati√®res' }}
            </option>
            <option *ngFor="let subject of getAvailableSubjects()" [value]="subject._id">
              {{ subject.name }}
            </option>
          </select>
        </div>
        <small class="filter-help" *ngIf="filters.selectedClass && getAvailableSubjects().length === 0">
          Aucune mati√®re assign√©e dans cette classe
        </small>
      </div>

      <div class="filter-group">
        <label for="trimester-select">
          Trimestre
        </label>
        <div class="filter-input-wrapper">
          <span class="filter-icon">üìÖ</span>
          <select 
            id="trimester-select"
            class="filter-select"
            [(ngModel)]="filters.selectedTrimester"
            (change)="onFilterChange()">
            <option value="">Tous les trimestres</option>
            <option *ngFor="let trimester of trimesters" [value]="trimester">
              {{ trimester }}
            </option>
          </select>
        </div>
      </div>

      <div class="filter-group">
        <label for="exam-type-select">
          Type d'examen
        </label>
        <div class="filter-input-wrapper">
          <span class="filter-icon">üìù</span>
          <select 
            id="exam-type-select"
            class="filter-select"
            [(ngModel)]="filters.selectedExamType"
            (change)="onFilterChange()">
            <option value="">Tous les types</option>
            <option *ngFor="let examType of examTypes" [value]="examType.value">
              {{ examType.label }}
            </option>
          </select>
        </div>
      </div>
    </div>
    
    <!-- R√©sum√© des filtres actifs -->
    <div class="active-filters" *ngIf="hasActiveFilters()">
      <span class="active-filters-label">Filtres actifs:</span>
      <div class="filter-tags">
        <span class="filter-tag" *ngIf="filters.selectedClass">
          {{ getClassName(filters.selectedClass) }}
          <button (click)="clearFilter('class')" class="tag-remove">√ó</button>
        </span>
        <span class="filter-tag" *ngIf="filters.selectedSubject">
          {{ getSubjectName(filters.selectedSubject) }}
          <button (click)="clearFilter('subject')" class="tag-remove">√ó</button>
        </span>
        <span class="filter-tag" *ngIf="filters.selectedTrimester">
          {{ filters.selectedTrimester }}
          <button (click)="clearFilter('trimester')" class="tag-remove">√ó</button>
        </span>
        <span class="filter-tag" *ngIf="filters.selectedExamType">
          {{ getExamTypeLabel(filters.selectedExamType) }}
          <button (click)="clearFilter('examType')" class="tag-remove">√ó</button>
        </span>
      </div>
    </div>
  </div>

  <!-- Basculement du mode d'affichage -->
  <div class="view-toggle" *ngIf="filteredGrades.length > 0 && filters.selectedSubject">
    <button 
      class="toggle-btn"
      [class.active]="viewMode === 'table'"
      (click)="onViewModeChange('table')">
      <span class="btn-icon">üìä</span>
      Vue Cartes
    </button>
    <button 
      class="toggle-btn"
      [class.active]="viewMode === 'students'"
      (click)="onViewModeChange('students')">
      <span class="btn-icon">üë•</span>
      Vue √âtudiants
    </button>
  </div>

  <!-- √âtat de chargement -->
  <div class="loading-container" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>Chargement des notes...</p>
  </div>

  <!-- Message aucune classe s√©lectionn√©e -->
  <div class="empty-state" *ngIf="!filters.selectedClass && !isLoading">
    <div class="empty-icon">üè´</div>
    <h3 class="empty-title">S√©lectionnez une classe</h3>
    <p class="empty-text">Veuillez s√©lectionner une classe pour voir les notes.</p>
  </div>

  <!-- Message aucune note -->
  <div class="empty-state" *ngIf="filters.selectedClass && !filters.selectedSubject && !isLoading">
    <div class="empty-icon">üìö</div>
    <h3 class="empty-title">S√©lectionnez une mati√®re</h3>
    <p class="empty-text">Veuillez s√©lectionner une mati√®re pour voir les notes.</p>
  </div>

  <!-- Message aucune note trouv√©e -->
  <div class="empty-state" *ngIf="filters.selectedClass && filters.selectedSubject && filteredGrades.length === 0 && !isLoading">
    <div class="empty-icon">üìä</div>
    <h3 class="empty-title">Aucune note trouv√©e</h3>
    <p class="empty-text">Aucune note ne correspond aux crit√®res s√©lectionn√©s.</p>
    <div class="empty-actions">
      <button class="create-btn" (click)="openCreateGradeForm()">
        <span class="btn-icon">‚ûï</span>
        Ajouter la premi√®re note
      </button>
      <button class="bulk-btn" (click)="openBulkGradeForm()" *ngIf="filters.selectedClass && filters.selectedSubject">
        <span class="btn-icon">üìä</span>
        Saisie group√©e pour toute la classe
      </button>
    </div>
  </div>

  <!-- Vue Cartes - IMPROVED LAYOUT -->
  <div class="grades-list-improved" *ngIf="viewMode === 'table' && filteredGrades.length > 0 && !isLoading && filters.selectedSubject">
    <div class="grade-card-improved" *ngFor="let grade of filteredGrades">
      <div class="grade-header-improved">
        <div class="grade-title-section">
          <h3 class="grade-title-improved">{{ grade.examName }}</h3>
          <span class="exam-type-badge-improved" [attr.data-type]="grade.examType">
            {{ getExamTypeLabel(grade.examType) }}
          </span>
        </div>
        <div class="grade-score-display">
          <span class="grade-value-large" [ngClass]="getGradeClass(grade.grade)">
            {{ grade.grade }}/20
          </span>
        </div>
      </div>
      
      <div class="grade-content">
        <div class="grade-meta-improved">
          <div class="meta-row">
            <span class="meta-icon">üë§</span>
            <span class="meta-text">{{ getStudentName(grade.student) }}</span>
          </div>
          <div class="meta-row">
            <span class="meta-icon">üìö</span>
            <span class="meta-text">{{ getSubjectName(grade.subject) }}</span>
          </div>
          <div class="meta-row">
            <span class="meta-icon">üìÖ</span>
            <span class="meta-text">{{ grade.trimester }}</span>
          </div>
          <div class="meta-row">
            <span class="meta-icon">üìä</span>
            <span class="meta-text">Coefficient {{ grade.coefficient }}</span>
          </div>
        </div>
        
        <div class="grade-details">
          <div class="detail-item">
            <span class="detail-label">Date d'examen:</span>
            <span class="detail-value">{{ grade.examDate | date:'dd/MM/yyyy' }}</span>
          </div>
        </div>
      </div>
      
      <!-- FIXED: Action buttons with proper visibility -->
      <div class="grade-actions-improved">
        <button 
          class="action-btn-improved edit-btn-improved"
          (click)="editGrade(grade)"
          title="Modifier"
          type="button">
          <span class="btn-icon">‚úèÔ∏è</span>
          Modifier
        </button>
        <button 
          class="action-btn-improved delete-btn-improved"
          (click)="openDeleteConfirmation(grade)"
          title="Supprimer"
          type="button">
          <span class="btn-icon">üóëÔ∏è</span>
          Supprimer
        </button>
      </div>
    </div>
  </div>

  <!-- Vue √âtudiants -->
  <div class="students-view" *ngIf="viewMode === 'students' && studentGradeSummaries.length > 0 && !isLoading && filters.selectedSubject">
    <div class="students-grid">
      <div class="student-card" *ngFor="let summary of studentGradeSummaries">
        <div class="student-header">
          <div class="student-avatar">
            {{ getStudentName(summary.student).charAt(0) }}
          </div>
          <div class="student-details">
            <h3>{{ getStudentName(summary.student) }}</h3>
            <p class="student-email">{{ summary.student.email }}</p>
          </div>
          <div class="student-stats">
            <div class="stat">
              <span class="stat-value grade-value" [ngClass]="getGradeClass(summary.average)">
                {{ summary.average | number:'1.2-2' }}
              </span>
              <span class="stat-label">Moyenne</span>
            </div>
            <div class="stat">
              <span class="stat-value">{{ summary.totalGrades }}</span>
              <span class="stat-label">Notes</span>
            </div>
          </div>
        </div>
        <div class="student-grades">
          <div class="grade-item" *ngFor="let grade of summary.grades">
            <div class="grade-info">
              <span class="grade-exam">{{ grade.examName }}</span>
              <span class="grade-type">{{ getExamTypeLabel(grade.examType) }}</span>
            </div>
            <div class="grade-score">
              <span class="grade-value" [ngClass]="getGradeClass(grade.grade)">
                {{ grade.grade }}/20
              </span>
              <span class="grade-coeff">Coeff. {{ grade.coefficient }}</span>
            </div>
            <div class="grade-actions">
              <button class="action-btn edit-btn" (click)="editGrade(grade)" type="button">
                <span class="btn-icon">‚úèÔ∏è</span>
              </button>
              <button class="action-btn delete-btn" (click)="openDeleteConfirmation(grade)" type="button">
                <span class="btn-icon">üóëÔ∏è</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de saisie group√©e des notes -->
  <div class="modal-overlay bulk-modal-overlay" *ngIf="showBulkGradeForm" (click)="cancelBulkForm()">
    <div class="modal-content bulk-modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">Saisie Group√©e des Notes</h2>
        <button class="close-btn" (click)="cancelBulkForm()" type="button">‚úï</button>
      </div>

      <div class="modal-body bulk-modal-body">
        <!-- Informations communes de l'examen -->
        <div class="exam-info-section">
          <h3 class="section-subtitle">Informations de l'Examen</h3>
          <div class="exam-info-grid">
            <div class="form-group">
              <label for="bulk-exam-name">Nom de l'examen *</label>
              <input 
                id="bulk-exam-name"
                type="text"
                class="form-input"
                [(ngModel)]="bulkGradeForm.examName"
                placeholder="Ex: Contr√¥le de Math√©matiques"
                required>
            </div>

            <div class="form-group">
              <label for="bulk-exam-type">Type d'examen *</label>
              <select 
                id="bulk-exam-type"
                class="form-select"
                [(ngModel)]="bulkGradeForm.examType"
                required>
                <option *ngFor="let examType of examTypes" [value]="examType.value">
                  {{ examType.label }}
                </option>
              </select>
            </div>

            <!-- ENHANCED: Coefficient with validation -->
            <div class="form-group">
              <label for="bulk-coefficient">Coefficient *</label>
              <input 
                id="bulk-coefficient"
                type="number"
                class="form-input"
                [class.error]="validateBulkCoefficient()"
                [(ngModel)]="bulkGradeForm.coefficient"
                (input)="onBulkCoefficientInput()"
                min="1"
                max="10"
                step="1"
                required>
              
              <div class="validation-error" *ngIf="validateBulkCoefficient()">
                <span class="error-icon">‚ö†Ô∏è</span>
                <span class="error-message">{{ validateBulkCoefficient() }}</span>
              </div>
              
              <small class="input-help" *ngIf="!validateBulkCoefficient()">
                Le coefficient doit √™tre entre 1 et 10
              </small>
            </div>

            <div class="form-group">
              <label for="bulk-exam-date">Date de l'examen *</label>
              <input 
                id="bulk-exam-date"
                type="date"
                class="form-input"
                [(ngModel)]="bulkGradeForm.examDate"
                required>
            </div>

            <div class="form-group">
              <label for="bulk-trimester">Trimestre *</label>
              <select 
                id="bulk-trimester"
                class="form-select"
                [(ngModel)]="bulkGradeForm.trimester"
                required>
                <option *ngFor="let trimester of trimesters" [value]="trimester">
                  {{ trimester }}
                </option>
              </select>
            </div>
          </div>
        </div>

        <!-- Section des notes des √©tudiants -->
        <div class="students-grades-section">
          <div class="section-header-bulk">
            <h3 class="section-subtitle">Notes des √âtudiants</h3>
            <div class="bulk-actions">
              <button class="quick-action-btn" (click)="fillAllWithValue(14)" title="Remplir avec 14" type="button">
                14/20
              </button>
              <button class="quick-action-btn" (click)="fillAllWithValue(16)" title="Remplir avec 16" type="button">
                16/20
              </button>
              <button class="quick-action-btn" (click)="fillAllWithValue(18)" title="Remplir avec 18" type="button">
                18/20
              </button>
              <button class="quick-action-btn clear-btn" (click)="clearAllGrades()" title="Effacer tout" type="button">
                <span class="btn-icon">üóëÔ∏è</span>
                Effacer
              </button>
            </div>
          </div>

          <div class="students-table-container">
            <table class="students-table">
              <thead>
                <tr>
                  <th class="student-name-col">Nom de l'√©tudiant</th>
                  <th class="grade-col">Note /20</th>
                  <th class="comment-col">Commentaire (optionnel)</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let studentGrade of bulkGradeForm.studentGrades; let i = index" 
                    [class.has-grade]="studentGrade.grade !== null && studentGrade.grade >= 0">
                  <td class="student-name-cell">
                    <div class="student-info">
                      <div class="student-avatar-small">
                        {{ getStudentName(studentGrade.student).charAt(0) }}
                      </div>
                      <span>{{ getStudentName(studentGrade.student) }}</span>
                    </div>
                  </td>
                  <td class="grade-cell">
                    <!-- ENHANCED: Grade input with validation -->
                    <input 
                      type="number"
                      class="grade-input"
                      [class.error]="studentGrade.touched && !isStudentGradeValid(studentGrade.grade)"
                      [(ngModel)]="studentGrade.grade"
                      (blur)="onStudentGradeBlur(i)"
                      min="0"
                      max="20"
                      step="0.5"
                      placeholder="--">
                    
                    <!-- ENHANCED: Show validation error for individual grades -->
                    <div class="grade-validation-error" *ngIf="studentGrade.touched && validateStudentGrade(studentGrade.grade)">
                      <small class="error-text">{{ validateStudentGrade(studentGrade.grade) }}</small>
                    </div>
                    
                    <span class="grade-indicator" *ngIf="studentGrade.grade !== null && studentGrade.grade >= 0 && isStudentGradeValid(studentGrade.grade)" 
                          [ngClass]="getGradeClass(studentGrade.grade)">
                      {{ getGradeAppreciation(studentGrade.grade) }}
                    </span>
                  </td>
                  <td class="comment-cell">
                    <textarea 
                      class="comment-input"
                      [(ngModel)]="studentGrade.comment"
                      placeholder="Ajouter un commentaire..."
                      rows="1"></textarea>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- R√©sum√© des statistiques -->
          <div class="bulk-summary">
            <div class="summary-stats">
              <div class="summary-stat">
                <span class="summary-label">Total √©tudiants:</span>
                <span class="summary-value">{{ bulkGradeForm.studentGrades.length }}</span>
              </div>
              <div class="summary-stat">
                <span class="summary-label">Notes saisies:</span>
                <span class="summary-value">{{ getCompletedGradesCount() }}</span>
              </div>
              <div class="summary-stat" *ngIf="getCompletedGradesCount() > 0">
                <span class="summary-label">Moyenne classe:</span>
                <span class="summary-value" [ngClass]="getGradeClass(getClassAverage())">
                  {{ getClassAverage() | number:'1.2-2' }}/20
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- FIXED: Form actions with proper buttons -->
        <div class="form-actions">
          <button 
            type="button" 
            class="btn btn-secondary"
            (click)="cancelBulkForm()"
            [disabled]="isSavingBulk">
            <span class="btn-icon">‚ùå</span>
            Annuler
          </button>
          <button 
            type="button" 
            class="btn btn-primary"
            (click)="saveBulkGrades()"
            [disabled]="!isBulkFormValid() || isSavingBulk">
            <span *ngIf="isSavingBulk" class="button-spinner"></span>
            <span *ngIf="!isSavingBulk" class="btn-icon">üíæ</span>
            {{ isSavingBulk ? 'Enregistrement...' : 'Enregistrer toutes les notes' }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal du formulaire de cr√©ation/modification de note individuelle -->
  <div class="modal-overlay" *ngIf="showCreateForm" (click)="cancelForm()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">{{ editingGrade ? 'Modifier la Note' : 'Ajouter une Note' }}</h2>
        <button class="close-btn" (click)="cancelForm()" type="button">‚úï</button>
      </div>

      <div class="modal-body">
        <form class="grade-form" (ngSubmit)="saveGrade()">
          <div class="form-grid">
            <div class="form-group">
              <label for="student-select">√âtudiant *</label>
              <select 
                id="student-select"
                class="form-select"
                [(ngModel)]="gradeForm.studentId"
                name="studentId"
                required
                [disabled]="!!editingGrade">
                <option value="">S√©lectionner un √©tudiant</option>
                <option *ngFor="let student of getStudentsForSelectedClass()" [value]="student._id">
                  {{ getStudentName(student) }}
                </option>
              </select>
            </div>

            <div class="form-group">
              <label for="subject-form-select">Mati√®re *</label>
              <select 
                id="subject-form-select"
                class="form-select"
                [(ngModel)]="gradeForm.subjectId"
                name="subjectId"
                required
                [disabled]="!!editingGrade || !filters.selectedClass">
                <option value="">
                  {{ !filters.selectedClass ? 'S√©lectionnez d\'abord une classe' : 'S√©lectionner une mati√®re' }}
                </option>
                <option *ngFor="let subject of getAvailableSubjects()" [value]="subject._id">
                  {{ subject.name }}
                </option>
              </select>
            </div>

            <div class="form-group">
              <label for="exam-name">Nom de l'examen *</label>
              <input 
                id="exam-name"
                type="text"
                class="form-input"
                [(ngModel)]="gradeForm.examName"
                name="examName"
                placeholder="Ex: Contr√¥le de Math√©matiques"
                required
                [disabled]="!!editingGrade">
            </div>

            <div class="form-group">
              <label for="exam-type-form">Type d'examen *</label>
              <select 
                id="exam-type-form"
                class="form-select"
                [(ngModel)]="gradeForm.examType"
                name="examType"
                required
                [disabled]="!!editingGrade">
                <option *ngFor="let examType of examTypes" [value]="examType.value">
                  {{ examType.label }}
                </option>
              </select>
            </div>

            <!-- ENHANCED: Grade input with validation -->
            <div class="form-group">
              <label for="grade-value">Note /20 *</label>
              <input 
                id="grade-value"
                type="number"
                class="form-input"
                [class.error]="gradeInputTouched && gradeValidationError"
                [(ngModel)]="gradeForm.grade"
                name="grade"
                min="0"
                max="20"
                step="0.5"
                required
                (input)="onGradeInput()"
                (blur)="onGradeInput()"
                placeholder="Saisir une note entre 0 et 20">
              
              <div class="validation-error" *ngIf="gradeInputTouched && gradeValidationError">
                <span class="error-icon">‚ö†Ô∏è</span>
                <span class="error-message">{{ gradeValidationError }}</span>
              </div>
              
              <small class="input-help" *ngIf="!gradeValidationError">
                La note doit √™tre comprise entre 0 et 20
              </small>
            </div>

            <!-- ENHANCED: Coefficient input with validation -->
            <div class="form-group">
              <label for="coefficient">Coefficient *</label>
              <input 
                id="coefficient"
                type="number"
                class="form-input"
                [class.error]="coefficientInputTouched && coefficientValidationError"
                [(ngModel)]="gradeForm.coefficient"
                name="coefficient"
                min="1"
                max="10"
                step="1"
                required
                (input)="onCoefficientInput()"
                (blur)="onCoefficientInput()"
                [disabled]="!!editingGrade">
                
              <div class="validation-error" *ngIf="coefficientInputTouched && coefficientValidationError">
                <span class="error-icon">‚ö†Ô∏è</span>
                <span class="error-message">{{ coefficientValidationError }}</span>
              </div>
              
              <small class="input-help" *ngIf="!coefficientValidationError">
                Le coefficient doit √™tre entre 1 et 10
              </small>
            </div>

            <div class="form-group">
              <label for="exam-date">Date de l'examen</label>
              <input 
                id="exam-date"
                type="date"
                class="form-input"
                [(ngModel)]="gradeForm.examDate"
                name="examDate"
                [disabled]="!!editingGrade">
            </div>

            <div class="form-group">
              <label for="trimester-form">Trimestre *</label>
              <select 
                id="trimester-form"
                class="form-select"
                [(ngModel)]="gradeForm.trimester"
                name="trimester"
                required
                [disabled]="!!editingGrade">
                <option *ngFor="let trimester of trimesters" [value]="trimester">
                  {{ trimester }}
                </option>
              </select>
            </div>
          </div>

          <div class="form-group full-width">
            <label for="comments">Commentaires</label>
            <textarea 
              id="comments"
              class="form-textarea"
              [(ngModel)]="gradeForm.comments"
              name="comments"
              placeholder="Commentaires sur la note..."
              rows="3"></textarea>
          </div>

          <!-- FIXED: Form actions with proper buttons -->
          <div class="form-actions">
            <button 
              type="button" 
              class="btn btn-secondary" 
              (click)="cancelForm()"
              [disabled]="isLoading">
              <span class="btn-icon">‚ùå</span>
              Annuler
            </button>
            <button 
              type="submit" 
              class="btn btn-primary"
              [disabled]="!isFormValid() || isLoading"
              [class.disabled]="!isFormValid() || isLoading">
              <span *ngIf="isLoading" class="button-spinner"></span>
              <span *ngIf="!isLoading" class="btn-icon">
                {{ editingGrade ? '‚úèÔ∏è' : '‚ûï' }}
              </span>
              {{ editingGrade ? 'Mettre √† jour' : 'Cr√©er la Note' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- FIXED: Delete Confirmation Modal with proper buttons -->
  <div class="modal-overlay delete-modal-overlay" *ngIf="showDeleteConfirmation" (click)="cancelDeleteConfirmation()">
    <div class="modal-content delete-modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header delete-modal-header">
        <div class="delete-icon-container">
          <span class="warning-icon">‚ö†Ô∏è</span>
        </div>
        <h3 class="delete-modal-title">Confirmer la suppression</h3>
        <button class="close-btn" (click)="cancelDeleteConfirmation()" type="button">‚úï</button>
      </div>

      <div class="modal-body delete-modal-body">
        <div class="delete-warning-message">
          <p>√ätes-vous s√ªr de vouloir supprimer cette note ?</p>
          <p class="warning-text">Cette action est irr√©versible.</p>
        </div>

        <div class="grade-details-card" *ngIf="gradeToDelete">
          <div class="grade-detail-row">
            <span class="detail-label">√âtudiant:</span>
            <span class="detail-value">{{ getStudentName(gradeToDelete.student) }}</span>
          </div>
          <div class="grade-detail-row">
            <span class="detail-label">Mati√®re:</span>
            <span class="detail-value">{{ getSubjectName(gradeToDelete.subject) }}</span>
          </div>
          <div class="grade-detail-row">
            <span class="detail-label">Examen:</span>
            <span class="detail-value">{{ gradeToDelete.examName }}</span>
          </div>
          <div class="grade-detail-row">
            <span class="detail-label">Type:</span>
            <span class="detail-value">{{ getExamTypeLabel(gradeToDelete.examType) }}</span>
          </div>
          <div class="grade-detail-row">
            <span class="detail-label">Note:</span>
            <span class="detail-value grade-highlight" [ngClass]="getGradeClass(gradeToDelete.grade)">
              {{ gradeToDelete.grade }}/20
            </span>
          </div>
          <div class="grade-detail-row">
            <span class="detail-label">Trimestre:</span>
            <span class="detail-value">{{ gradeToDelete.trimester }}</span>
          </div>
        </div>
      </div>

      <!-- FIXED: Delete Modal Actions with explicit button types -->
      <div class="delete-modal-actions">
        <button 
          type="button" 
          class="btn btn-secondary delete-cancel-btn" 
          (click)="cancelDeleteConfirmation()"
          [disabled]="isDeleting">
          <span class="btn-icon">‚ùå</span>
          Annuler
        </button>
        <button 
          type="button" 
          class="btn btn-danger delete-confirm-btn" 
          (click)="confirmDeleteGrade()"
          [disabled]="isDeleting">
          <span *ngIf="isDeleting" class="delete-spinner"></span>
          <span *ngIf="!isDeleting" class="btn-icon">üóëÔ∏è</span>
          {{ isDeleting ? 'Suppression...' : 'Supprimer d√©finitivement' }}
        </button>
      </div>
    </div>
  </div>

  <!-- General Confirmation Modal -->
  <div class="modal-overlay confirmation-modal-overlay" *ngIf="showConfirmationModal" (click)="closeConfirmationModal()">
    <div class="modal-content confirmation-modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header confirmation-modal-header" [attr.data-type]="confirmationModalConfig.type">
        <div class="confirmation-icon-container" [attr.data-type]="confirmationModalConfig.type">
          <span class="confirmation-icon">
            {{ confirmationModalConfig.type === 'danger' ? '‚ö†Ô∏è' : 
               confirmationModalConfig.type === 'info' ? '‚ÑπÔ∏è' : '‚ùì' }}
          </span>
        </div>
        <h3>{{ confirmationModalConfig.title }}</h3>
        <button class="close-btn" (click)="closeConfirmationModal()" type="button">‚úï</button>
      </div>

      <div class="confirmation-modal-body">
        <p>{{ confirmationModalConfig.message }}</p>
      </div>

      <div class="confirmation-modal-actions">
        <button 
          type="button" 
          class="btn btn-secondary" 
          (click)="closeConfirmationModal()">
          {{ confirmationModalConfig.cancelText }}
        </button>
        <button 
          type="button" 
          class="btn"
          [ngClass]="{
            'btn-danger': confirmationModalConfig.type === 'danger',
            'btn-warning': confirmationModalConfig.type === 'warning',
            'btn-primary': confirmationModalConfig.type === 'info'
          }"
          (click)="confirmAction()">
          <span class="btn-icon">‚úì</span>
          {{ confirmationModalConfig.confirmText }}
        </button>
      </div>
    </div>
  </div>
</section>